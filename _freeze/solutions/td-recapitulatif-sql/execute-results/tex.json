{
  "hash": "ed04a139a560d3185fe5d595c4f25c50",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"TD Récapitulatif SQL\"\nformat:\n  pdf:\n    code-annotations: below\n    keep-tex: false\n    code-fold: false\n    toc: false\n    output-file: td-recap-sql.pdf\n    include-in-header:\n      - text: \"\\\\lhead{{\\\\sf  Base de données \\\\\\\\ TD Récapitulatif SQL }}\"\n  html:\n    embed-resources: true\n    code-fold: true\n    output-file: td-recap-sql.html\nparams:\n    year: 2024 \n    curriculum: \"L3 MIASHS/Ingémath\"\n    university: \"Université Paris Cité\"\n    homepage: \"https://stephane-v-boucheron.fr/courses/bdd\"\n    moodle: \"https://moodle.u-paris.fr/course/view.php?id=2313\"\n---\n\n\n\n\n\n\n::: {.content-visible when-profile='solution'} \n\n::: {.callout-warning}\n\n### Avec solutions\n\n::: \n\n:::\n\n\n::: {layout=\"[80,20]\"}\n\n::: {#first-column}\n\n\n- **L3 MIASHS/Ingémath**\n- **[Université Paris Cité](https://www.u-paris.fr)**\n- Année 2024-2025\n- [Course Homepage](https://stephane-v-boucheron.fr/courses/bdd)  \n- [Moodle](https://moodle.u-paris.fr/course/view.php?id=2313)\n\n::: \n\n::: {#second-column}\n![](../images/UniversiteParis_monogramme_couleur_RVB.png){align=\"right\" style=\"size:50px;\" width=75}\n:::\n\n:::\n\n\n\n# Recapitulatif SQL\n\nUtiliser les outils les plus adaptés parmi ceux vus depuis le début de l'année pour répondre aux questions suivantes.\n\n## Schéma `world`\n\n::: {.callout-note title=\"Question\"}\n\nQuel est le pays qui a le plus de villes recensées dans la table `world.city`? Combien de villes ? (363 villes)\n\n:::\n\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\n```{.sql}\nWITH country_city AS\n\t(SELECT name_country , COUNT(name_city) nbrcity\n\tFROM world.country NATURAL JOIN world.city\n\tGROUP BY name_country)\n\nSELECT name_country, nbrcity\nFROM country_city\nWHERE nbrcity = (SELECT MAX(nbrcity) \n\t\t\t\t FROM country_city) ;\n```\n\n::::: \n:::\n\n::: {.callout-note title=\"Question\"}\n\nQuels sont les pays qui ont $3$ ou plus langues officielles ? (8 lignes)\n\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\n```{.sql}\nSELECT name_country\nFROM world.country NATURAL JOIN world.countrylanguage\nWHERE isofficial\nGROUP BY name_country HAVING COUNT(*) > 2 ;\n```\n\n:::::\n\n:::\n\n\n::: {.callout-note title=\"Question\"}\n\nQuels sont les pays dont plus de $1.000.000$ d'habitants parlent une langue non officielle ? (72 lignes)\n\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\n```{.sql}\nSELECT DISTINCT name_country\nFROM world.country NATURAL JOIN world.countrylanguage\nWHERE (NOT isofficial) AND \n\t  (percentage / 100) * population_country >= 1000000 ;\n```\n\n:::::\n\n:::\n\n\n::: {.callout-note title=\"Question\"}\n\nQuelles sont les langues qui sont officielles dans tous les continents où au moins une langue est parlée ? (1 ligne)\n\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\n\n```{.sql}\nWITH R AS\n\t(SELECT count(DISTINCT continent)\n\tFROM world.country NATURAL JOIN world.countrylanguage)\nSELECT language, count(DISTINCT continent) as nbcon\nFROM world.country NATURAL JOIN world.countrylanguage WHERE isofficial\nGROUP BY language\n\tHAVING count(DISTINCT continent) in (SELECT * FROM R)\nORDER BY nbcon DESC ;\n```\n\n:::::\n\nou\n\n::::: {.callout-tip title=\"Solution\"}\n\n```{.sql}\nWITH continent_language AS\n\t(SELECT DISTINCT language , continent\n\tFROM country NATURAL JOIN countrylanguage\n\tWHERE isofficial),\nall_continent_language AS\n\t(SELECT DISTINCT l.language , c.continent\n\tFROM countrylanguage l , continent_language c),\nnot_continent_language AS\n\t((SELECT * FROM all_continent_language)\n\tEXCEPT\n\t(SELECT * FROM continent_language))\nSELECT DISTINCT language\nFROM countrylanguage\nWHERE language NOT IN (SELECT language FROM not_continent_language) ;\n```\n\n:::::\n\n:::\n\n\n::: {.callout-note title=\"Question\"} \n\nQuels sont les pays pour lesquels une langue non officielle est parlée par strictement plus de monde (dans le pays) qu'il n'y a d'habitants dans la capitale ? (118 lignes)\n\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\n```{.sql}\nSELECT DISTINCT name_country\nFROM (country c JOIN city ON id = capital)\n\tJOIN countrylanguage l ON c.countrycode = l.countrycode\nWHERE NOT isofficial\nAND percentage / 100 * population_country > population_city ;\n```\n\n:::::\n\n:::\n\n::: {.callout-note title=\"Question\"}\n\nQuels est le nombre de villes par ` region` ?\n\n:::\n\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\n```{.sql}\nSELECT region , COUNT(id) AS nbr_city\nFROM country NATURAL JOIN city\nGROUP BY region ;\n```\n\n:::::\n\n:::\n\n\n\n## Schéma `pagila`\n\n\n\n\n::: {.callout-note title=\"Question\"}\n\nQuel est l'acteur (`actor_id`) présent sur le plus de DVD (`inventory_id`) ?\n\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\n```{.sql}\nWITH actor_dvd AS\n\t(SELECT actor_id , count(inventory_id) nbrdvd\n\tFROM actor NATURAL JOIN film_actor NATURAL JOIN inventory\n\tGROUP BY actor_id)\nSELECT first_name , last_name\nFROM actor NATURAL JOIN actor_dvd\nWHERE nbrdvd = (SELECT MAX(nbrdvd) FROM actor_dvd) ;\n```\n\n:::::\n\n:::\n\n\n::: {.callout-note title=\"Question\"}\n\nQuel est le prix moyen d'une location de DVD ?\n\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\n```{.sql}\nSELECT AVG(amount) \nFROM payment ;\n```\n\n:::::\n\n:::\n\n::: {.callout-note title=\"Question\"}\n\nQuel est le DVD qui a rapporté le plus d'argent ? Le film  (`film_id`)?\n\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\nPour le DVD:\n\n```{.sql}\nWITH inventory_amount AS\n\t(SELECT inventory_id , SUM(amount) AS dollar\n\tFROM inventory NATURAL JOIN rental NATURAL JOIN payment\n\tGROUP BY inventory_id)\nSELECT inventory_id , dollar\nFROM  inventory_amount\nWHERE dollar >= ALL (SELECT dollar FROM inventory_amount) ;\n```\n\n:::::\n\n\n::::: {.callout-tip title=\"Solution\"}\n\nEt pour le film:\n\n\n```{.sql}\nWITH film_amount AS\n\t(SELECT film_id , SUM(amount) AS dollar\n\tFROM inventory NATURAL JOIN rental NATURAL JOIN payment\n\tGROUP BY film_id)\nSELECT film_id , dollar\nFROM  inventory_amount\nWHERE dollar >= ALL (SELECT dollar FROM film_amount) ;\n```\n\n:::::\n\n:::\n\n\n::: {.callout-note title=\"Question\"}\n\nQuels sont les employés (`staff_id`) qui travaillent dans une autre ville que celle dans laquelle ils vivent ? (4 lignes)\n\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\n```{.sql}\nWITH staff_maison AS\n\t(SELECT staff_id , city_id\n\tFROM (staff NATURAL JOIN address)),\nstaff_travail AS\n\t(SELECT staff_id , city_id\n\tFROM (staff p JOIN store s ON p.store_id = s.store_id) , address a\n\tWHERE a.address_id = s.address_id)\nSELECT staff_id FROM staff_travail NATURAL JOIN staff_maison ;\n```\n\n:::::\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}