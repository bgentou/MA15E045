{
  "hash": "27535fbe7b2c9ab38289383d04bc0a36",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: ''\nformat:\n  pdf:\n    code-annotations: below\n    keep-tex: false\n    code-fold: false\n    toc: false\n    output-file: nycflights-schema.pdf\n    include-in-header:\n      - text: \"\\\\lhead{{\\\\sf  Base de données \\\\\\\\ NYCFlights}}\"\n  html:\n    embed-resources: true\n    code-fold: true\n    output-file: nycflights-schema.html\nparams:\n    year: 2024 \n    curriculum: \"L3 MIASHS/Ingémath\"\n    university: \"Université Paris Cité\"\n    homepage: \"https://stephane-v-boucheron.fr/courses/bdd\"\n    moodle: \"https://moodle.u-paris.fr/course/view.php?id=2313\"\nengine: knitr\n---\n\n\n\n\n\n\n::: {layout=\"[80,20]\"}\n\n::: {#first-column}\n\n<!-- {{< meta title >>}} -->\n\n- **L3 MIASHS/Ingémath**\n- **[Université Paris Cité](https://www.u-paris.fr)**\n- Année 2024-2025\n- [Course Homepage](https://stephane-v-boucheron.fr/courses/bdd)  \n- [Moodle](https://moodle.u-paris.fr/course/view.php?id=2313)\n\n::: \n\n::: {#second-column}\n![](../images/UniversiteParis_monogramme_couleur_RVB.png){align=\"right\" style=\"size:50px;\" width=75}\n:::\n\n:::\n\n\n`NYCFlights`  est mis en œuvre sur le serveur `etu-pgsql` dans \nla base `bd_2023-24` dans le schéma `nycflights_bis`.\n\n::: {.callout-important}\n\nSur le serveur, `nycflights_bis` n'est pas *peuplé* (toutes les tables sont vides). \n\n:::\n\n\n\n\n### Définition du schéma en SQL\n\n\n::: {layout=\"[50,50]\"}\n\n::: {#first-column}\n\n\n```{.sql}\nCREATE TABLE airlines (\n\tcarrier text NOT NULL,\n\t\"name\" text NULL,\n\tCONSTRAINT airlines_pk \n        PRIMARY KEY (carrier),\n\tCONSTRAINT airlines_un \n        UNIQUE (name)\n);\n```\n\n```{.sql}\nCREATE TABLE airports (\n\tfaa text NOT NULL,\n\t\"name\" text NULL,\n\tlat float8 NULL,\n\tlon float8 NULL,\n\talt float8 NULL,\n\ttz float8 NULL,\n\tdst text NULL,\n\ttzone text NULL,\n\tCONSTRAINT airports_pk \n        PRIMARY KEY (faa),\n\tCONSTRAINT airports_un \n        UNIQUE (name),\n\tCONSTRAINT airports_un_ll \n        UNIQUE (lat, lon)\n);\n```\n\n\n\n:::\n\n::: {#second-column}\n\n\n```{.sql}\nCREATE TABLE weather (\n\torigin text NOT NULL,\n\t\"year\" int4 NULL,\n\t\"month\" int4 NULL,\n\t\"day\" int4 NULL,\n\t\"hour\" int4 NULL,\n\t\"temp\" float8 NULL,\n\tdewp float8 NULL,\n\thumid float8 NULL,\n\twind_dir float8 NULL,\n\twind_speed float8 NULL,\n\twind_gust float8 NULL,\n\tprecip float8 NULL,\n\tpressure float8 NULL,\n\tvisib float8 NULL,\n\ttime_hour timestamptz NOT NULL,\n\tCONSTRAINT weather_pk \n        PRIMARY KEY (origin, time_hour)\n);\n```\n\n```{.sql}\nALTER TABLE weather ADD \n    CONSTRAINT weather_fk \n    FOREIGN KEY (origin) \n    REFERENCES airports(faa) \n    ON DELETE CASCADE \n    ON UPDATE CASCADE;\n```\n\n:::\n\n:::\n\n```{.sql}\nCREATE TABLE planes (\n\ttailnum text NOT NULL,\n\t\"year\" int4 NULL,\n\t\"type\" text NULL,\n\tmanufacturer text NULL,\n\tmodel text NULL,\n\tengines int4 NULL,\n\tseats int4 NULL,\n\tspeed int4 NULL,\n\tengine text NULL,\n\tCONSTRAINT planes_pk   PRIMARY KEY (tailnum)\n);\n```\n\n\n::: {layout=\"[50,50]\"}\n\n::: {#first-column}\n\n```{.sql}\nCREATE TABLE flights (\n\t\"year\" int4 NULL,\n\t\"month\" int4 NULL,\n\t\"day\" int4 NULL,\n\tdep_time int4 NULL,\n\tsched_dep_time int4 NULL,\n\tdep_delay float8 NULL,\n\tarr_time int4 NULL,\n\tsched_arr_time int4 NULL,\n\tarr_delay float8 NULL,\n\tcarrier text NULL,\n\tflight int4 NULL,\n\ttailnum text NOT NULL,\n\torigin text NOT NULL,\n\tdest text NULL,\n\tair_time float8 NULL,\n\tdistance float8 NULL,\n\t\"hour\" float8 NULL,\n\t\"minute\" float8 NULL,\n\ttime_hour timestamptz NOT NULL,\n\tCONSTRAINT flights_pk \n        PRIMARY KEY (\n            tailnum, origin, time_hour)\n);\n```\n\n:::\n\n\n\n::: {#second-column}\n\n```{.sql}\nALTER TABLE flights ADD \n    CONSTRAINT flights_fk \n    FOREIGN KEY (carrier) \n    REFERENCES airlines(carrier) \n    ON DELETE SET NULL \n    ON UPDATE CASCADE;\n```\n\n```{.sql}\nALTER TABLE flights ADD \n    CONSTRAINT flights_fk_dest \n    FOREIGN KEY (dest) \n    REFERENCES airports(faa) \n    ON DELETE SET NULL \n    ON UPDATE CASCADE;\n```\n\n```{.sql}\nALTER TABLE flights ADD \n    CONSTRAINT flights_fk_origin \n    FOREIGN KEY (origin) \n    REFERENCES airports(faa) \n    ON DELETE SET NULL \n    ON UPDATE CASCADE;\n```\n\n```{.sql}\nALTER TABLE flights ADD \n    CONSTRAINT flights_fk_planes \n    FOREIGN KEY (tailnum) \n    REFERENCES planes(tailnum) \n    ON DELETE SET NULL \n    ON UPDATE CASCADE;\n```\n\n:::\n\n:::\n\n\n\n### Dépendances fonctionnelles\n\nEn plus des contraintes de clé primaire ou d'unicité, \nles dépendances fonctionnelles suivantes pourraient être mises en place grâce à des contraintes `EXCLUDE`. \n\nTable `weather`\n\n- `time_hour → year, month, day, hour`\n- `year, month, day, hour  → time_hour`\n\nTable `planes`\n\n- `model → manufacturer, engines, engine, type`\n\nTable `flights`\n\n- `tailnum, time_hour → carrier`\n- `time_hour → sched_dep_time`\n- `sched_dep_time, dep_time → dep_delay`\n- `sched_arr_time, arr_time → arr_delay`\n- `origin, dest, dep_time, arr_time → airtime`\n- `time_hour → year, month, day, hour, minute`\n- `year, month, day, hour, minute → time_hour`\n- `origin, dest → distance`\n\n\n\n\n{{< pagebreak >}}\n\n\n\n\n\n\n**Présentation graphique du schéma relationnel**\n\n![NYC Flights (pattes de corbeaux)](../images/nycflights_layout.svg){width=\"75%\"}\n",
    "supporting": [
      "nycflights_layout_wrapper_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}