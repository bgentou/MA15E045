{
  "hash": "98023863e42cc675c4e40e7cbd6a2ad9",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat:\n  pdf:\n    code-annotations: below\n    code-fold: false\n    toc: false\n    output-file: cc2-2023-11-24.pdf\n    include-in-header:\n      - text: \"\\\\lhead{{\\\\sf  Base de données (BD5) \\\\\\\\ CC 2023-24: 2}}\"\n  html:\n    standalone: true\n    code-fold: true\n    output-file: cc2-2023-11-24.html\nparams:\n    year: 2023\n    curriculum: \"L3 MIASHS/Ingémath\"\n    university: \"Université Paris Cité\"\n    homepage: \"https://stephane-v-boucheron.fr/courses/bdd\"\n    moodle: \"https://moodle.u-paris.fr/course/view.php?id=2313\"\n---\n\n\n\n\n\n\n\n::: {layout=\"[80,20]\"}\n\n::: {#first-column}\n\n\n\n- **CC 2** 2023-11-24 16h30-18h45\n\n- **L3 MIASHS/Ingémath**\n- **[Université Paris Cité](https://www.u-paris.fr)**\n- Année 2023-2024\n- [Course Homepage](https://stephane-v-boucheron.fr/courses/bdd)  \n- [Moodle](https://moodle.u-paris.fr/course/view.php?id=2313)\n\n::: \n\n::: {#second-column}\n![](/images/UniversiteParis_monogramme_couleur_RVB.png){align=\"right\" style=\"size:50px;\" width=75}\n:::\n\n:::\n\n::: {.content-hidden when-profile=\"solution\"}\n::: {.callout-caution}\n\n- Pas de documents autorisés\n- Pas de téléphone portable \n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n::: {.callout-tip}\nPour chaque question, proposer une requête écrite en algèbre relationnelle ou en `SQL`. \n:::\n\n\n::: {.callout-note  title=\"Question 1\"}  \n\nDans le schéma `world`, lister les pays où les dix plus grandes villes ont chacune \nau moins 10 millions d'habitants. \n\n\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\n```{.sql}\nSELECT \n  ci.countrycode\nFROM \n  world.city ci \nWHERE \n  ci.population_city > 10000000\nGROUP BY \n  ci.countrycode \nHAVING \n  COUNT(ci.id) >= 10 ;\n```\n\n:::::\n\n:::\n\n\n::: {.callout-note  title=\"Question 2\"}  \n\nDans le schéma `world`, pour chaque pays, donner les trois langues les plus parlées.  \n \n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\n\n```{.sql}\nWITH R AS (\n  SELECT \n    cl.countrycode, cl.language, \n    RANK() OVER w AS rnk \n  FROM \n    world.countrylanguage cl \n  WINDOW \n    w AS (PARTITION BY cl.countrycode ORDER BY cl.percentage DESC)\n)\n\nSELECT \n  R.countrycode, R.language\nFROM \n  R\nWHERE \n  R.rnk <= 3 ;\n```\n\n:::::\n\n:::\n\n\n::: {.callout-note  title=\"Question 3\"}  \n\nDans le schéma `world`, lister les langues parlées sur tous les continents. \n\n:::\n\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\n\n```{.sql}\nSELECT\n  language\nFROM\n  country co\nNATURAL JOIN\n  countrylanguage cl\nGROUP BY\n  cl.language\nHAVING COUNT(DISTINCT co.continent) = (\n  SELECT COUNT(DISTINCT c.continent) FROM country c\n) ;\n```\n\n:::::\n\n:::\n\n::: {.callout-note  title=\"Question 4\"}  \n\n\nDans le schéma `world`, lister par région le nombre de langues officielles distinctes.\n\n\n:::\n\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\n\n```{.sql}\nSELECT \n  co.region, \n  COUNT(DISTINCT cl.language) AS n\nFROM \n  world.countrylanguage cl \nNATURAL JOIN \n  world.country co \nWHERE \n  cl.isofficial\nGROUP BY \n  co.region\n```\n\n:::::\n\n:::\n\n\n::: {.callout-note  title=\"Question 5\"}  \n\nDans le schéma `world`, lister pour chaque forme de gouvernement, la population des villes des pays qui subissent cette forme de gouvernement.\n\n\n:::\n\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\n\n```{.sql}\nSELECT \n  co.governmentform, \n  SUM(ci.population) AS pop\nFROM \n  world.country co \nJOIN \n  world.city ci  USING (countrycode)\nGROUP BY \n  co.governmentform ;\n```\n\n:::::\n\n:::\n\n\n\n::: {.callout-note  title=\"Question 6\"}  \n\nDans le schéma `world`, lister les pays où la capitale est \nla ville la plus peuplée.\n\n\n:::\n\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\n\n```{.sql}\nWITH R AS (\n  SELECT \n    co.countrycode, co.name_country, ci. name, ci.id, ci.population,\n    (co.capital=ci.id) AS capitale, -- <1>\n    RANK() OVER (PARTITION BY co.countrycode ORDER BY ci.population DESC) AS rnk -- <2> \n  FROM \n      world.country co\n    JOIN\n      world.city ci  USING (countrycode) \n)\n\nSELECT \n  R.name_country, R. name, R.population\nFROM \n  R \nWHERE \n  capitale AND rnk = 1   -- <3> \n;  \n```\n1. On note les villes qui sont capitales \n2. On range les villes d'un pays par population décroissante\n3. On ne garde que les capitales qui sont aussi les villes les plus peuplées du royaume\n:::::\n\n:::\n\n\n::: {.callout-note  title=\"Question 7\"}  \n\nDans le schéma `world`, lister les pays où $90\\%$ de la population\nparle une langue officielle (il peut y avoir plusieurs langues\nofficielles, dont la somme des locuteurs et locutrices dépasse\n$90\\%$ de la population).\n\n\n:::\n\n::: {.content-visible when-profile=\"solution\"}\n\n::::: {.callout-tip title=\"Solution\"}\n\n\n```{.sql}\nSELECT \n  cl.countrycode\nFROM \n  world.countrylanguage cl \nWHERE \n  cl.isofficial\nGROUP BY cl.countrycode\nHAVING SUM(cl.percentage) >= 90 ;\n```\n\n:::::\n\n:::\n\n\n\n\n\n{{< pagebreak >}}\n\n\n\n\n\n\n\nToutes les questions portent sur le schéma `world`.\n\n\n![Schéma `world`](/images/world.png){width=8cm}\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}